$ bun test tests/production/
bun test v1.2.20 (6ad208bc)

tests/production/cli-serve.test.ts:
11 |     try {
12 |       await runIsol8("serve", { env: { ISOL8_API_KEY: "" } });
13 |       throw new Error("Should have failed");
14 |     } catch (err: any) {
15 |       expect(err.code).toBe(1);
16 |       expect(err.stderr).toContain("API key required");
                              ^
error: expect(received).toContain(expected)

Expected to contain: "API key required"
Received: "[ERR] The serve command requires Bun runtime.\n      Install Bun: https://bun.sh\n      Then run: bun run src/cli.ts serve\n"

      at <anonymous> (/Users/dhruv/Developer/Projects/isol8/tests/production/cli-serve.test.ts:16:26)
(fail) CLI Serve > serve without --key or ISOL8_API_KEY exits with error [136.86ms]
19 | 
20 |   test("serve --help lists all flags", async () => {
21 |     const { stdout } = await runIsol8("serve --help");
22 |     expect(stdout).toContain("--port");
23 |     expect(stdout).toContain("--key");
24 |     expect(stdout).toContain("--update");
                        ^
error: expect(received).toContain(expected)

Expected to contain: "--update"
Received: "Usage: isol8 serve [options]\n\nStart the isol8 remote server\n\nOptions:\n  -p, --port <port>  Port to listen on (default: \"3000\")\n  -k, --key <key>    API key for authentication\n  -h, --help         display help for command\n"

      at <anonymous> (/Users/dhruv/Developer/Projects/isol8/tests/production/cli-serve.test.ts:24:20)
(fail) CLI Serve > serve --help lists all flags [123.09ms]

tests/production/cli-setup.test.ts:
954 |   if (!isURLInstance(fileURLOrPath))
955 |     return fileURLOrPath;
956 |   return Bun.fileURLToPath(fileURLOrPath);
957 | }
958 | var { Error, TypeError } = globalThis;
959 |   let err = new Error(message);
                  ^
error: Command failed: isol8 setup
- Checking Docker...
[OK] Docker is running
- Building isol8 images...
node:events:485
      throw er; // Unhandled 'error' event
      ^

Error: ENOENT: no such file or directory, lstat '/Users/dhruv/Developer/Projects/isol8/node_modules/docker/Dockerfile'
Emitted 'error' event on Pack instance at:
    at Pack.destroy (file:///Users/dhruv/Developer/Projects/isol8/node_modules/isol8/dist/cli.js:26703:12)
    at onstat (file:///Users/dhruv/Developer/Projects/isol8/node_modules/isol8/dist/cli.js:27016:21)
    at file:///Users/dhruv/Developer/Projects/isol8/node_modules/isol8/dist/cli.js:26953:18
    at FSReqCallback.oncomplete (node:fs:198:21) {
  errno: -2,
  code: 'ENOENT',
  syscall: 'lstat',
  path: '/Users/dhruv/Developer/Projects/isol8/node_modules/docker/Dockerfile'
}

Node.js v23.0.0

   code: 1,
 killed: false,
 signal: null,
    cmd: "isol8 setup",
 stdout: "",
 stderr: "- Checking Docker...\n[OK] Docker is running\n- Building isol8 images...\nnode:events:485\n      throw er; // Unhandled 'error' event\n      ^\n\nError: ENOENT: no such file or directory, lstat '/Users/dhruv/Developer/Projects/isol8/node_modules/docker/Dockerfile'\nEmitted 'error' event on Pack instance at:\n    at Pack.destroy (file:///Users/dhruv/Developer/Projects/isol8/node_modules/isol8/dist/cli.js:26703:12)\n    at onstat (file:///Users/dhruv/Developer/Projects/isol8/node_modules/isol8/dist/cli.js:27016:21)\n    at file:///Users/dhruv/Developer/Projects/isol8/node_modules/isol8/dist/cli.js:26953:18\n    at FSReqCallback.oncomplete (node:fs:198:21) {\n  errno: -2,\n  code: 'ENOENT',\n  syscall: 'lstat',\n  path: '/Users/dhruv/Developer/Projects/isol8/node_modules/docker/Dockerfile'\n}\n\nNode.js v23.0.0\n",

      at genericNodeError (node:child_process:959:13)
      at exitHandler (node:child_process:103:28)
      at emit (node:events:98:22)
      at #maybeClose (node:child_process:746:16)
      at #handleOnExit (node:child_process:520:72)
(fail) CLI Setup > setup completes successfully [130.47ms]

 72 pass
 3 fail
 118 expect() calls
Ran 75 tests across 9 files. [39.65s]
error: script "test:prod" exited with code 1
