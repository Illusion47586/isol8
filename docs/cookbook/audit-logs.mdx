---
title: "Audit Logging"
description: "Enable and configure execution audit logs for compliance and monitoring"
og:title: "Audit Logging - isol8 Cookbook"
og:description: "Learn how to enable audit logging in isol8, integrate with CloudWatch, Splunk, and other log aggregation systems."
---

Audit logging records every code execution with metadata including timestamps, resource usage, and security events. This guide shows you how to enable audit logs and integrate them with external monitoring systems.

## Quick Start

Enable basic audit logging in your configuration file:

```json
{
  "audit": {
    "enabled": true,
    "trackResources": true
  }
}
```

Logs are written to `./.isol8_audit/executions.log` by default.

## Viewing Audit Logs

### Local Development

```bash
# View recent logs
tail -f .isol8_audit/executions.log

# Pretty-print with jq
cat .isol8_audit/executions.log | jq '.'

# Filter by runtime
cat .isol8_audit/executions.log | jq 'select(.runtime == "python")'

# Filter by exit code (find failures)
cat .isol8_audit/executions.log | jq 'select(.exitCode != 0)'
```

### Log Format

Each line is a JSON object:

```json
{
  "executionId": "550e8400-e29b-41d4-a716-446655440000",
  "userId": "user-123",
  "timestamp": "2026-02-17T20:00:00.000Z",
  "runtime": "python",
  "codeHash": "a1b2c3d4e5f6...",
  "containerId": "abc123def456",
  "exitCode": 0,
  "durationMs": 82,
  "resourceUsage": {
    "cpuPercent": 12.5,
    "memoryMB": 64,
    "networkBytesIn": 0,
    "networkBytesOut": 0
  },
  "metadata": {
    "tenantId": "tenant-456",
    "requestId": "req-789"
  }
}
```

## Custom Log Directory

Store logs in a specific location:

```json
{
  "audit": {
    "enabled": true,
    "logDir": "/var/log/isol8",
    "retentionDays": 30
  }
}
```

The `retentionDays` option automatically cleans up files older than the specified number of days.

## Adding Metadata

Include context with each execution:

```typescript
const result = await isol8.execute({
  code: 'print("hello")',
  runtime: "python",
  metadata: {
    userId: "user-123",
    tenantId: "tenant-456",
    requestId: "req-789",
    environment: "production",
  },
});
```

Metadata appears in the audit log under the `metadata` field and is useful for:
- Tracking which user made a request
- Multi-tenant billing and quotas
- Request tracing and debugging
- Compliance reporting

## Integration Examples

### CloudWatch Logs

Create a post-log script to send entries to AWS CloudWatch:

```bash
#!/usr/bin/env bash
# /usr/local/bin/send-to-cloudwatch.sh

LOG_FILE="$1"
LOG_GROUP="isol8"
LOG_STREAM="executions"

# Read the last line (most recent entry)
LAST_ENTRY=$(tail -1 "$LOG_FILE")

# Get current timestamp in milliseconds
TIMESTAMP=$(date +%s%3N)

# Send to CloudWatch
aws logs put-log-events \
  --log-group-name "$LOG_GROUP" \
  --log-stream-name "$LOG_STREAM" \
  --log-events "[{\"timestamp\": $TIMESTAMP, \"message\": $LAST_ENTRY}]" \
  2>/dev/null
```

Configure isol8 to use it:

```json
{
  "audit": {
    "enabled": true,
    "logDir": "/var/log/isol8",
    "postLogScript": "/usr/local/bin/send-to-cloudwatch.sh"
  }
}
```

### Splunk HTTP Event Collector

```bash
#!/usr/bin/env bash
# /usr/local/bin/send-to-splunk.sh

LOG_FILE="$1"
SPLUNK_URL="https://your-splunk-instance:8088"
SPLUNK_TOKEN="your-hec-token"

# Read the last line
LAST_ENTRY=$(tail -1 "$LOG_FILE")

# Send to Splunk HEC
curl -k "$SPLUNK_URL/services/collector/event" \
  -H "Authorization: Splunk $SPLUNK_TOKEN" \
  -d "{\"event\": $LAST_ENTRY}"
```

### Custom Webhook

Send audit entries to your own API:

```bash
#!/usr/bin/env bash
# /usr/local/bin/send-to-webhook.sh

LOG_FILE="$1"
WEBHOOK_URL="https://your-api.com/audit-logs"
API_KEY="your-api-key"

# Read the last line
LAST_ENTRY=$(tail -1 "$LOG_FILE")

# Send to webhook
curl -X POST "$WEBHOOK_URL" \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $API_KEY" \
  -d "$LAST_ENTRY"
```

## Privacy Considerations

### Code Logging

By default, only the SHA-256 hash of the code is logged (not the code itself). Enable full code logging only when necessary:

```json
{
  "audit": {
    "enabled": true,
    "includeCode": true
  }
}
```

Use cases for code logging:
- Complete code provenance for compliance
- Reproducibility in research environments
- Debugging complex failures

### Output Logging

Output logging is disabled by default. Enable it to capture stdout/stderr:

```json
{
  "audit": {
    "enabled": true,
    "includeOutput": true
  }
}
```

⚠️ **Warning**: Output may contain sensitive data. Enable only in controlled environments.

### Example with Privacy Controls

```json
{
  "audit": {
    "enabled": true,
    "includeCode": false,
    "includeOutput": false,
    "trackResources": true,
    "logDir": "/secure/audit-logs",
    "retentionDays": 365
  }
}
```

## Monitoring Security Events

When running in `filtered` network mode, blocked requests are logged as security events:

```json
{
  "executionId": "...",
  "securityEvents": [
    {
      "type": "network_blocked",
      "message": "Security event: network_blocked",
      "details": {
        "method": "CONNECT",
        "host": "unauthorized-site.com",
        "reason": "filter_mismatch"
      },
      "timestamp": "2026-02-17T20:00:00Z"
    }
  ]
}
```

Monitor these events to detect:
- Attempted data exfiltration
- Misconfigured allowlists
- Abuse of the execution service

### Alerting on Security Events

Create a script to alert when security events occur:

```bash
#!/usr/bin/env bash
# /usr/local/bin/security-alert.sh

LOG_FILE="$1"
LAST_ENTRY=$(tail -1 "$LOG_FILE")

# Check if entry has security events
if echo "$LAST_ENTRY" | jq -e '.securityEvents | length > 0' > /dev/null 2>&1; then
  # Send alert to Slack/PagerDuty/email
  curl -X POST "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK" \
    -H 'Content-Type: application/json' \
    -d "{\"text\": \"Security event detected: $LAST_ENTRY\"}"
fi
```

## Resource Usage Tracking

Enable resource tracking to monitor CPU, memory, and network usage:

```json
{
  "audit": {
    "enabled": true,
    "trackResources": true
  }
}
```

Resource metrics help with:
- **Billing**: Charge users based on actual resource consumption
- **Optimization**: Identify inefficient code
- **Capacity planning**: Understand resource usage patterns
- **Anomaly detection**: Spot unusual resource consumption

### Example: Finding Resource-Heavy Executions

```bash
# Find executions using >100MB memory
cat .isol8_audit/executions.log | jq 'select(.resourceUsage.memoryMB > 100)'

# Find slow executions (>5 seconds)
cat .isol8_audit/executions.log | jq 'select(.durationMs > 5000)'

# Calculate average CPU usage by runtime
cat .isol8_audit/executions.log | jq -s '
  group_by(.runtime) | 
  map({
    runtime: .[0].runtime,
    avgCpu: (map(.resourceUsage.cpuPercent) | add / length)
  })
'
```

## Retention and Cleanup

Configure automatic cleanup of old logs:

```json
{
  "audit": {
    "enabled": true,
    "retentionDays": 90
  }
}
```

Logs older than 90 days are automatically removed when the AuditLogger initializes.

### Manual Cleanup

For immediate cleanup:

```bash
# Remove logs older than 30 days
find /var/log/isol8 -name "*.log" -mtime +30 -delete

# Archive old logs before deletion
tar -czf "isol8-audit-$(date +%Y%m%d).tar.gz" /var/log/isol8/*.log
find /var/log/isol8 -name "*.log" -mtime +90 -delete
```

## Production Deployment Checklist

<Steps>
  <Step title="Enable audit logging">
    Set `"audit.enabled": true` in production configurations.
  </Step>
  <Step title="Choose appropriate retention">
    Set retention based on compliance requirements (30-365 days typical).
  </Step>
  <Step title="Configure log directory">
    Use a persistent, backed-up directory like `/var/log/isol8`.
  </Step>
  <Step title="Set up log rotation">
    Configure post-log script to forward to your log aggregation system.
  </Step>
  <Step title="Monitor security events">
    Set up alerts for blocked network requests and policy violations.
  </Step>
  <Step title="Review privacy settings">
    Ensure `includeCode` and `includeOutput` are only enabled when necessary.
  </Step>
</Steps>

## Troubleshooting

### Logs not appearing

1. Check that audit is enabled: `isol8 config` should show `"audit.enabled": true`
2. Verify the log directory exists and is writable
3. Check server logs for errors

### High disk usage

1. Reduce `retentionDays`
2. Disable `trackResources` if not needed
3. Ensure `includeCode` and `includeOutput` are disabled

### Post-log script not running

1. Verify script path is correct
2. Check script permissions (must be executable)
3. Review server logs for spawn errors
4. Test script manually: `./script.sh /path/to/executions.log`
