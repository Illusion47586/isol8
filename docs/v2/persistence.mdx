---
title: "Data & Persistence"
description: "How to handle files, state, and persistent sessions in isol8."
icon: "database"
---

By default, isol8 runs in **ephemeral mode**, where every execution starts with a clean slate. However, you can use **persistent mode** to maintain state across multiple executions, or simply use file I/O to transfer data in and out.

## Ephemeral vs. Persistent

### Ephemeral Mode (Default)
- **State**: None. `/sandbox` is wiped after every run.
- **Latency**: Fast (~130ms warm).
- **Use Case**: One-off scripts, stateless functions.

### Persistent Mode (`--persistent`)
- **State**: Files and variables persist between runs.
- **Latency**: Initial setup (~300ms), subsequent runs fast (~120ms).
- **Use Case**: REPL sessions, multi-step workflows, data pipelines.

<Warning>
  Persistent containers are locked to a single runtime. You cannot switch from Python to Node.js in the same persistent session.
</Warning>

## File I/O

Transfer files into and out of the container easily.

### 1. Injecting Files (`files`)

Pass files before execution starts.

<Tabs>
  <Tab title="Library">
    ```typescript
    const result = await isol8.execute({
      code: 'print(open("/sandbox/data.txt").read())',
      runtime: "python",
      files: {
        "/sandbox/data.txt": "hello world",
      },
    });
    ```
  </Tab>
  <Tab title="API">
    ```json
    {
      "request": {
        "files": {
          "/sandbox/data.txt": "hello world"
        }
      }
    }
    ```
  </Tab>
  <Tab title="CLI">
    *Note: The CLI currently does not support injecting arbitrary files via flags. Use stdin for data.*
  </Tab>
</Tabs>

### 2. Retrieving Files (`outputPaths`)

Get files back after execution finishes.

<Tabs>
  <Tab title="Library">
    ```typescript
    const result = await isol8.execute({
      code: 'open("/sandbox/out.csv", "w").write("a,b")',
      runtime: "python",
      outputPaths: ["/sandbox/out.csv"],
    });
    ```
  </Tab>
  <Tab title="API">
    ```json
    {
      "request": {
        "outputPaths": ["/sandbox/out.csv"]
      }
    }
    ```
  </Tab>
  <Tab title="CLI">
    *Note: The CLI currently writes stdout to file via `--out`. Retrieval of internal files is not supported via flags.*
  </Tab>
</Tabs>

### 3. Direct File Transfer (Persistent Only)

Upload/download files to a running session without executing code.

<Tabs>
  <Tab title="Library">
    ```typescript
    const isol8 = new DockerIsol8({ mode: "persistent" });
    await isol8.putFile("/sandbox/data.csv", "1,2,3");
    const content = await isol8.getFile("/sandbox/data.csv");
    ```
  </Tab>
  <Tab title="API">
    ```bash
    # Upload
    curl -X POST http://localhost:3000/file \
      -d '{"sessionId": "...", "path": "/sandbox/data.csv", "content": "base64..."}'

    # Download
    curl http://localhost:3000/file?sessionId=...&path=/sandbox/data.csv
    ```
  </Tab>
  <Tab title="CLI">
    *Not supported.*
  </Tab>
</Tabs>

## Persistent Sessions

### CLI Usage

Use `--persistent` to keep state between runs.

```bash
# Run 1: Set variable
isol8 run --persistent -e "x = 42" --runtime python

# Run 2: Read variable (same container reused)
isol8 run --persistent -e "print(x)" --runtime python
```

### Library Usage

Set `mode: "persistent"` in the constructor.

```typescript
const isol8 = new DockerIsol8({ mode: "persistent" });
await isol8.start();

// Every execute() call reuses the same container
await isol8.execute({ code: "x = 10", runtime: "python" });
await isol8.execute({ code: "x += 5", runtime: "python" });
await isol8.execute({ code: "print(x)", runtime: "python" }); // 15

await isol8.stop(); // Destroys the container
```

### Server Sessions

Use `sessionId` to identify persistent sessions on the server.

```bash
# Create session "session-123"
curl -X POST http://localhost:3000/execute 
  -d '{"request": {"code": "x=1", "runtime": "python"}, "sessionId": "session-123"}'

# Reuse session "session-123"
curl -X POST http://localhost:3000/execute 
  -d '{"request": {"code": "print(x)", "runtime": "python"}, "sessionId": "session-123"}'
```

Sessions are automatically pruned by the server if they haven't been accessed for 1 hour (default).

<Note>
  The timeout is based on **idle time** (last access), not creation time. As long as you keep using the session, it stays alive. Configure the limit with `cleanup.maxContainerAgeMs`.
</Note>

## Stdin/Stdout

For simple text data, piping via stdin/stdout is often easiest.

```bash
# Pipe JSON data
echo '{"name": "Alice"}' | isol8 run script.py

## Reference

<CardGroup cols={2}>
  <Card title="Library API" icon="code" href="/v2/library">
    Full documentation for `putFile()`, `getFile()`, and `execute()`.
  </Card>
  <Card title="CLI Reference" icon="terminal" href="/v2/cli">
    See flags for `isol8 run --persistent` and other commands.
  </Card>
</CardGroup>
