---
title: "isol8 setup"
description: "Build Docker images and install custom dependencies"
og:title: "isol8 setup - CLI Reference"
og:description: "Build base and custom runtime images for isol8. Pre-install dependencies for Python, Node.js, Bun, and more."
---

Verify Docker connectivity and build all base `isol8:<runtime>` images. Optionally build custom images with pre-installed dependencies.

```bash
isol8 setup [options]
```

## What It Does

```mermaid
flowchart TD
    A[isol8 setup] --> B{Docker running?}
    B -->|No| C[Exit with error]
    B -->|Yes| D{Images up to date?}
    D -->|Yes| E[Skip build]
    D -->|No| F[Build base images]
    F --> F1[isol8:python]
    F --> F2[isol8:node]
    F --> F3[isol8:bun]
    F --> F4[isol8:deno]
    F --> F5[isol8:bash]
    E & F1 & F2 & F3 & F4 & F5 --> G{Packages specified?}
    G -->|No| H[Done]
    G -->|Yes| I{Custom images up to date?}
    I -->|Yes| H
    I -->|No| J[Build custom images]
    J --> K["isol8:{runtime}-custom"]
    K --> L[Remove old dangling images]
    L --> H
```

1. **Verify Docker** — Pings the Docker daemon to confirm it's running and accessible.
2. **Smart build detection** — Computes SHA256 hashes of the `docker/` directory contents and dependency lists. If images exist with matching hashes, they are skipped.
3. **Build base images** — Builds all 5 runtime images from the multi-stage `docker/Dockerfile`. Each runtime is a separate build target (`python`, `node`, `bun`, `deno`, `bash`).
4. **Build custom images** — If package flags are provided (via CLI flags or `config.dependencies`), builds custom images with dependencies pre-installed.
5. **Cleanup** — After rebuilding, removes old dangling images to prevent disk space accumulation.

## Options

<ResponseField name="--python" type="string">
  Comma-separated Python packages to install via pip.

  ```bash
  isol8 setup --python numpy,pandas,scipy
  ```
</ResponseField>

<ResponseField name="--force" type="boolean">
  Force rebuild even if images are up to date. Use this when you want to ensure a fresh build regardless of the smart build detection.

  ```bash
  isol8 setup --force
  ```
</ResponseField>

<ResponseField name="--node" type="string">
  Comma-separated Node.js packages to install via npm.

  ```bash
  isol8 setup --node lodash,express,axios
  ```
</ResponseField>

<ResponseField name="--bun" type="string">
  Comma-separated Bun packages to install via bun.

  ```bash
  isol8 setup --bun zod,hono,drizzle-orm
  ```
</ResponseField>

<ResponseField name="--deno" type="string">
  Comma-separated Deno module URLs to pre-cache via `deno cache`.

  ```bash
  isol8 setup --deno https://deno.land/std/path/mod.ts
  ```
</ResponseField>

<ResponseField name="--bash" type="string">
  Comma-separated Alpine apk packages to install.

  ```bash
  isol8 setup --bash curl,git,jq,wget
  ```
</ResponseField>

## Custom Images

When you provide package flags (or have `dependencies` in your config file), isol8 builds a custom image tagged `isol8:<runtime>-custom`. These custom images are **automatically preferred** over base images via the `resolveImage()` logic — if `isol8:python-custom` exists, all Python executions use it without any additional flags.

Package names are validated to prevent command injection. Allowed characters are alphanumeric, `-`, `_`, `.`, `/`, `@`, and `=`.

For example, after running:

```bash
isol8 setup --python numpy,pandas
```

The image `isol8:python-custom` is created with numpy and pandas pre-installed. All subsequent Python executions automatically use this image.

### How Custom Images Are Built

Custom images extend the base image with runtime-specific install commands. The generated Dockerfile for each runtime:

| Runtime | Generated Dockerfile |
|:--------|:--------------------|
| `python` | `FROM isol8:python`<br/>`RUN pip install --no-cache-dir numpy pandas` |
| `node` | `FROM isol8:node`<br/>`RUN npm install -g lodash express` |
| `bun` | `FROM isol8:bun`<br/>`RUN bun install -g zod hono` |
| `deno` | `FROM isol8:deno`<br/>`RUN deno cache https://deno.land/std/path/mod.ts` |
| `bash` | `FROM isol8:bash`<br/>`RUN apk add --no-cache jq curl` |

CLI flags are merged with any packages already specified in `config.dependencies`, so both sources contribute to the custom image.

## Smart Builds

`isol8 setup` uses intelligent caching to skip unnecessary rebuilds. It works by:

1. **Computing hashes** — SHA256 hashes of:
   - `docker/` directory contents (Dockerfile, proxy.sh, proxy-handler.sh)
   - Dependency lists for each runtime
2. **Storing metadata** — Hashes are stored as Docker labels on each image:
   - `org.isol8.build.hash` — Hash of docker/ directory
   - `org.isol8.deps.hash` — Hash of dependency list
3. **Comparing** — Before building, isol8 checks if an image exists with matching hashes
4. **Skipping** — If hashes match, the build is skipped and "Up to date" is displayed

This means:
- Running `isol8 setup` twice without changes skips all builds
- Modifying `docker/Dockerfile` triggers rebuilds
- Changing `config.dependencies` triggers custom image rebuilds
- Adding packages via `--python`, `--node`, etc. triggers rebuilds

### Forcing Rebuilds

Use `--force` to bypass smart detection and rebuild all images:

```bash
isol8 setup --force
```

This is useful when:
- You want to ensure a completely fresh build
- Docker layer caching has issues
- You're troubleshooting image problems

## Base Images

All base images are built from a multi-stage `Dockerfile` in the `docker/` directory. The shared `base` stage is Alpine 3.21 and includes:

- `tini` as the init process (PID 1 signal handling)
- `curl` and `ca-certificates`
- The HTTP/HTTPS filtering proxy (`proxy.sh` + `proxy-handler.sh`) copied to `/usr/local/bin/`
- `/sandbox` as the working directory
- `tini` as the entrypoint

Each runtime stage extends `base` with its specific runtime binary:

| Stage | Base | Installs |
|:------|:-----|:---------|
| `python` | `base` | `python3`, `py3-pip` |
| `node` | `base` | `nodejs`, `npm` |
| `bun` | `base` | `bash`, `unzip`, `libstdc++`, `libgcc`, then downloads Bun via install script |
| `deno` | `denoland/deno:alpine` | `tini`, `curl`, `ca-certificates`, `proxy.sh`, `proxy-handler.sh` |
| `bash` | `base` | `bash` |

<Note>
  The Deno stage uses `denoland/deno:alpine` as its base image instead of the shared `base` stage. It independently installs `tini`, `curl`, and `ca-certificates`, and copies `proxy.sh` + `proxy-handler.sh` — mirroring the setup from `base` but starting from the official Deno Alpine image.
</Note>
